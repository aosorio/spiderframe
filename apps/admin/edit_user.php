<?php define("TO_ROOT", "../..");  require_once TO_ROOT . "/core/includes/main.inc.php";  $Page = new Form("Edit user", "add_user");    /* ---------------- <<<< Load Class Models >>>> --------------------------------------------------------------------------*/  $user_rol = (isset($_GET["user_rol"])) ? $_GET["user_rol"] : "user" ;  $user_login_id = (isset($_GET["user_login_id"])) ? $_GET["user_login_id"] : 0 ;    $Login = Login::getInstance($user_login_id);  $Login->load();    $user_id = ($Login->getUserID()) ? $Login->getUserID() : 0 ;  $address_id = ($Login->getAddressID()) ? $Login->getAddressID() : 0 ;  $user_rol_id = ($Login->getUserRolID($user_rol)) ? $Login->getUserRolID($user_rol) : 0 ;    $User = User::getInstance($user_id);  $User->load();    $Address = UserAddress::getInstance($address_id);  $Address->load();    $UserRol = Row::getInstance("cat_user_x_rol", $user_rol_id);  $UserRol->load();  /* ---------------- <<<< End Load Class Models >>>> ---------------------------------------------------------------------*/    /* ---------------- <<<< Set Row on Form >>>> --------------------------------------------------------------------------*/  $Page->setRow($Login);  $Page->setRow($User);    if($address_id != 0)  { 	  	$Page->setRow($Address);   }    $Page->setRow($UserRol);  /* ---------------- <<<< End Set Row on Form  >>>> ---------------------------------------------------------------------*/      /* ---------------- <<<< Set Genarl Variables >>>> ----------------------------------------------------------------------*/  $location =  Functions::__getLocationByCity($Address->data["city_id"]);  $city_id = ($location["city_id"]) ? $location["city_id"] : CITY_ID ;  $state_id = ($location["state_id"]) ? $location["state_id"] : STATE_ID ;  $country_id = ($location["country_id"]) ? $location["country_id"] : COUNTRY_ID ;     $countries_array = Functions::__getCountries();  $states_array = Functions::__getStates($country_id);  $cities_array = Functions::__getCities($state_id);  /* ---------------- <<<< End Set Genarl Variables  >>>> -----------------------------------------------------------------*/      /* ---------------- <<<< Configure Fields >>>> --------------------------------------------------------------------------*/  $Page->insertTitle("Login data", "mail","before");  $Page->insertTitle("User data", "names","before");    if($address_id != 0)  {   	$Page->insertTitle("Address data", "city_id","before");  }    $Page->insertField("password_confirm", "", "password");  $Page->setFieldProperty("password_confirm", "type", "password");  $Page->setFieldProperty("password_confirm", "data-id", "password_confirm");    $Page->hideField("curp");     if($address_id != 0)  { 	  $Page->insertField("state_id", "", "city_id", "before");	  $Page->setFieldProperty("state_id", "type", "select");	  $Page->setLabel("state_id", "State");		  $Page->showField("city_id");	  $Page->setFieldProperty("city_id", "type", "select");  }    if($user_login_id == 0)  {  	$Page->setFieldValue("birthday", "01/01/1980");  	$Page->hideField("user_login_date");  }  else {  	 $Page->unsetFieldProperty("user_login_date", "class", "__date");  }    if($user_rol_id == 0)  {  	$Page->setFieldValue("cat_user_rol_id", Functions::__getCatUserRolID($user_rol));  }     //Example ----->>>>  $Page->setFieldRequired(array("password","street","number"));  $Page->setFieldRequired("all");    if($address_id != 0)  {   	$Page->unsetFieldRequired(array("postal_zip","place","interior","address_detail","address_cross"));  }  /* ---------------- <<<< End Configure Fields >>>> ----------------------------------------------------------------------*/      /* ---------------- <<<< Configure Sturdy Row >>>> ----------------------------------------------------------------------*/  $Page->setSturdyRowProtect("user_login", array("password"=>"md5") );  $Page->setSturdyRowTransformDate("user_login", "user_login_date");  $Page->setSturdyRowIgnoreClean("user_login", "password");    //$Page->setSturdyRowFunction("user_login", "secret", "__createSecret", "user_login, secret");    $Page->setSturdyRowTransformDate("user", "birthday");  $Page->setSturdyRowAsignValue("user", array("user_login_id"=>"user_login_id") );  //$Page->setSturdyRowAsignValue("user", array("names"=>"TEst") );    $Page->setSturdyRowAsignValue("cat_user_x_rol", array("user_id"=>"user_id") );    if($address_id != 0)  {   	$Page->setSturdyRowAsignValue("user_address", array("user_id"=>"user_id") );  }  /* ---------------- <<<< End Configure Sturdy Row >>>> ------------------------------------------------------------------*/      /* ---------------- <<<< Configure PHP Antions >>>> ---------------------------------------------------------------------*/  $Page->addAction("Save", "add_user_action");  $Page->addAction("Cancel", "cancel_user_action");  /* ---------------- <<<< End Configure PHP Actions >>>> -----------------------------------------------------------------*/      /* ---------------- <<<< Configure Js Actions >>>> ----------------------------------------------------------------------*/  $Page->setOnReady("__focus", "first");    //Example ----->>>> $Page->setOnReady("$('#user_login_date_1').datepicker", "{'dateFormat':'DD dd, MM, yy'}");    $Page->setOnReady("$('.__date').datepicker", "{'dateFormat':'dd/mm/yy'}");    if($address_id != 0)  { 	  $Page->setOnReady("__setCitiesOnSelect", "state_id_0", "city_id_{$address_id}");	  $Page->setOnReady("__createOptionForComboBox", "state_id_0", json_encode($states_array), $state_id);	  $Page->setOnReady("__createOptionForComboBox", "city_id_{$address_id}", json_encode($cities_array), $city_id);   }  /* ---------------- <<<< End Configure Js Actions >>>> -----------------------------------------------------------------*/      /* ---------------- <<<< Set Menus >>>> --------------------------------------------------------------------------------*/  $Page->setSecondaryMenu("admin_users");  /* ---------------- <<<< End Set Menus >>>> ----------------------------------------------------------------------------*/      /* ---------------- <<<< Configure Jquery CSS Theme >>>> ---------------------------------------------------------------*/  $Page->setJqueryTheme("cupertino");  /* ---------------- <<<< End Configure Jquery CSS Theme >>>> -----------------------------------------------------------*/      /* ---------------- <<<< Configure CSS Theme >>>> ----------------------------------------------------------------------*/    /* ---------------- <<<< End Configure CSS Theme >>>> ------------------------------------------------------------------*/      /* ---------------- <<<< Configure JS Scripts >>>> ---------------------------------------------------------------------*/  $Page->addJsLink(TO_ROOT . "/apps/admin/subcore/scripts/script.add_user.js");  /* ---------------- <<<< End Configure JS Scripts >>>> -----------------------------------------------------------------*/      $Page->display();  