<?php define("TO_ROOT", "../..");  require_once TO_ROOT . "/core/includes/main.inc.php";  $Page = new Form("Add Client");    /* ---------------- <<<< Assert User Permissions >>>> ---------------------------------------------------------------------*/  /** *  if(!System::__assertLoginType($_SESSION["login_type"]) && !System::__hasPermission("user", "add_user"))  {  	System::__sessionDestroy();  	$Page->setOnReady("__showMessage","{'message':'Sorry you dont have permission','options':{'OK':function(){__goToPage('index.php')}}}");  	$Page->goToPage();  }  /* ---------------- <<<< End Assert User Permissions >>>> ----------------------------------------------------------------*/      /* ---------------- <<<< Load Class Models >>>> --------------------------------------------------------------------------*/  $cat_client_id = (isset($_GET["cat_client_id"])) ? $_GET["cat_client_id"] : 0 ;    $Client = ($cat_client_id >= 0) ? Row::getInstance("cat_client", $cat_client_id) : Row::getNewInstance("cat_client", 0);  $Client->load();  /* ---------------- <<<< End Load Class Models >>>> ---------------------------------------------------------------------*/  $address_id = FiscalFunctions::__getClientAddressID($cat_client_id);	  $Address = ($address_id >= 1) ? UserAddress::getInstance($address_id) : UserAddress::getNewInstance("user_address", 0);  $Address->load();      /* ---------------- <<<< Set Row on Form >>>> --------------------------------------------------------------------------*/  $Page->setRow($Client);  $Page->setRow($Address);     /* ---------------- <<<< End Set Row on Form  >>>> ---------------------------------------------------------------------*/      /* ---------------- <<<< Set Genarl Variables >>>> ----------------------------------------------------------------------*/    /* ---------------- <<<< End Set Genarl Variables  >>>> -----------------------------------------------------------------*/  $location =  Functions::__getLocationByCity($Address->data["city_id"]);  $city_id = ($location["city_id"]) ? $location["city_id"] : CITY_ID ;  $state_id = ($location["state_id"]) ? $location["state_id"] : STATE_ID ;  $country_id = ($location["country_id"]) ? $location["country_id"] : COUNTRY_ID ;     $countries_array = Functions::__getCountries();  $states_array = Functions::__getStates($country_id);  $cities_array = Functions::__getCities($state_id);  /* ---------------- <<<< Configure Fields >>>> --------------------------------------------------------------------------*/  $Page->setFieldRequired("all");  $Page->unsetFieldRequired(array("postal_zip","place","interior","address_detail","address_cross"));    $Page->setFieldValue("user_login_id", $_SESSION['user_login_id']);  $Page->hideField("status_client");  $Page->hideField("date");  $Page->hideField("date_low");   $Page->insertTitle("Client data", "client","before");  $Page->insertTitle("Address data", "city_id","before");  $Page->insertField("state_id", "", "city_id", "before");  $Page->setFieldProperty("state_id", "type", "select");  $Page->setLabel("state_id", "State");  $Page->showField("city_id");  $Page->setFieldProperty("city_id", "type", "select"); /* ---------------- <<<< End Configure Fields >>>> ----------------------------------------------------------------------*/      /* ---------------- <<<< Configure Sturdy Row >>>> ----------------------------------------------------------------------*/  $Page->setSturdyRowTransformDate("cat_client", array("date","date_low"));  $Page->setSturdyRowAsignValue("user_address", array("user_id"=>"cat_client_id", "cat_address_id"=>"6") );   /* ---------------- <<<< End Configure Sturdy Row >>>> ------------------------------------------------------------------*/      /* ---------------- <<<< Configure PHP Antions >>>> ---------------------------------------------------------------------*/  $Page->addAction("Save");  $Page->addAction("Cancel");  /* ---------------- <<<< End Configure PHP Actions >>>> -----------------------------------------------------------------*/      /* ---------------- <<<< Configure Js Actions >>>> ----------------------------------------------------------------------*/  $Page->setOnReady("__focus", "first");  $Page->setOnReady("__setCitiesOnSelect", "state_id_0", "city_id_{$address_id}");  $Page->setOnReady("__createOptionForComboBox", "state_id_0", json_encode($states_array), $state_id);  $Page->setOnReady("__createOptionForComboBox", "city_id_{$address_id}", json_encode($cities_array), $city_id);   //$Page->setOnReady("$('.__date').datepicker", "{'dateFormat':'dd/mm/yy'}");  /* ---------------- <<<< End Configure Js Actions >>>> -----------------------------------------------------------------*/      /* ---------------- <<<< Set Menus >>>> --------------------------------------------------------------------------------*/ //$Page->setSecondaryMenu("report");  /* ---------------- <<<< End Set Menus >>>> ----------------------------------------------------------------------------*/      /* ---------------- <<<< Configure Jquery CSS Theme >>>> ---------------------------------------------------------------*/  //$Page->setJQueryTheme("sunny");  /* ---------------- <<<< End Configure Jquery CSS Theme >>>> -----------------------------------------------------------*/      /* ---------------- <<<< Configure CSS Theme >>>> ----------------------------------------------------------------------*/  $Page->addCssLink(TO_ROOT . "/apps/subcore/style/forms.css");  /* ---------------- <<<< End Configure CSS Theme >>>> ------------------------------------------------------------------*/      /* ---------------- <<<< Configure JS Scripts >>>> ---------------------------------------------------------------------*/  $Page->addJsLink(TO_ROOT . "/apps/fiscal/subcore/scripts/script.add_client.js");  /* ---------------- <<<< End Configure JS Scripts >>>> -----------------------------------------------------------------*/      $Page->display();